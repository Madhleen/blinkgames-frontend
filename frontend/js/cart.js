import { mountHeader } from './header.js'; import { BRL, getCart, saveCart, updateBadge, getToken } from './state.js'; import { CheckoutAPI } from './api.js'; mountHeader();
const list=document.getElementById('list'); const empty=document.getElementById('empty'); const totalEl=document.getElementById('total');
function render(){const cart=getCart(); list.innerHTML=''; if(cart.length===0){empty.style.display='block'; totalEl.textContent=BRL(0);return;} empty.style.display='none'; let total=0; cart.forEach((i,idx)=>{const sub=(i.price||0)*(i.quantity||0); total+=sub; const li=document.createElement('li'); li.innerHTML=`<div class="panel" style="display:flex;gap:14px;align-items:center;margin-bottom:10px"><img src="${i.image||'img/icons/placeholder.svg'}" style="width:70px;height:70px;object-fit:cover;border-radius:12px;border:1px solid rgba(255,0,200,.22)"><div style="flex:1"><strong>${i.title}</strong><div>${i.quantity}x — R$ ${BRL(sub)}</div><small>Números: ${(i.numbers||[]).slice(0,8).join(', ')}${(i.numbers||[]).length>8?'…':''}</small></div><button class="btn" data-remove="${idx}">Remover</button></div>`; list.appendChild(li);}); totalEl.textContent=BRL(total);} render();
list.addEventListener('click',e=>{const btn=e.target.closest('button[data-remove]'); if(!btn) return; const idx=Number(btn.dataset.remove); const cart=getCart(); cart.splice(idx,1); saveCart(cart); render();});
document.getElementById('checkout')?.addEventListener('click',async()=>{const token=getToken(); try{await CheckoutAPI.create(getCart(),token); alert('Pedido criado!'); localStorage.removeItem('blink_cart'); updateBadge(); location.href='minhas-rifas.html';}catch(err){alert(err.message||'Falha no checkout');}});